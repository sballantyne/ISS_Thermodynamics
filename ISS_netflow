function res = ISS_netflow()
%% Define Variables
habitable_volume = 935; %m^3
air_density = 1.225e3; %g/m^3
air_specific_heat = 1.005; %J/(g * K)
air_mass = habitable_volume * air_density; %g

%% Initial Energy:
initialTemp = 295.15; %Average temp onboard ISS in K
initialEnergy = tempToEnergy(initialTemp, air_mass, air_specific_heat); %Initial onboard energy in J

%% Time Settings
initialTime = 0; %sec
finalTime = 60 * 90; %sec = 90 min

%% Netflow Loop
    [T, U] = ode45(@netFlows, [initialTime, finalTime], initialEnergy);
    
%% Results
output_energy = U;
subplot(2,1,1)
plot(T/60, output_energy, 'b-')

output_temp = energyToTemp(U, air_mass, air_specific_heat);
subplot(2,1,2)
plot(T/60, output_temp, 'r-')

    function res = netFlows(~, U)
        current_energy = U;
        inflow = radiation_inflow() + electrical_heat(true) + body_heat();
        outflow = radiation_outflow(current_energy) + cooling_system + window_radiation_outflow(current_energy);
        res = inflow - outflow;
    end
   

end

function res = energyToTemp(U, m, c)
res = U/(m*c);
end

function res = tempToEnergy(T, m, c)
res = T * m * c;
end
